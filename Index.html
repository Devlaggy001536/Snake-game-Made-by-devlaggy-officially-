<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HTCJaSnake</title>

<style>
:root{
  --bg:#0b1a12;
  --panel:#10261a;
  --accent:#00ff99;
  --snake:#00d9ff;
  --tail:#1fa36a;
  --btn:#00ff99;
}

body{
  margin:0;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:
    linear-gradient(90deg, rgba(0,255,150,.06) 1px, transparent 1px),
    linear-gradient(rgba(0,255,150,.06) 1px, transparent 1px),
    var(--bg);
  background-size:40px 40px;
  font-family:system-ui;
  color:white;
}

#wrap{
  display:flex;
  gap:14px;
}

canvas{
  width:400px;
  height:400px;
  background:#08140d;
  border:3px solid var(--accent);
}

#ui{
  background:var(--panel);
  padding:14px;
  border-radius:18px;
  display:flex;
  flex-direction:column;
  gap:10px;
  min-width:170px;
}

#score{
  font-size:18px;
  color:var(--accent);
}

button,input{
  border:none;
  border-radius:14px;
  padding:8px;
  font-size:14px;
}

button{
  background:var(--btn);
  cursor:pointer;
}

#overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  justify-content:center;
  align-items:center;
}

#gameover{
  background:var(--panel);
  padding:20px;
  border-radius:22px;
  text-align:center;
}
</style>
</head>

<body>

<div id="wrap">
  <canvas id="game" width="400" height="400"></canvas>

  <div id="ui">
    <div id="score">Score: 0 | Best: 0</div>
    <label>Speed
      <input type="range" id="speed" min="120" max="400" value="240">
    </label>
    <button id="pause">Pause</button>
    <button onclick="resetGame()">New Game</button>
  </div>
</div>

<div id="overlay">
  <div id="gameover">
    <h2>Game Over</h2>
    <p id="finalScore"></p>
    <button onclick="resetGame()">New Game</button>
  </div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const box = 20;
const grid = 20;

let snake, food, dir, score;
let gameOver=false, paused=false;
let speedDelay=240, lastMove=0;

let bestScore = Number(localStorage.getItem("htcja_best")) || 0;

// --- Curved head drawer (rotates with direction) ---
function drawCapRect(x,y,w,h,r,dir){
  ctx.beginPath();

  if(dir==="UP"){
    ctx.moveTo(x+r,y);
    ctx.lineTo(x+w-r,y);
    ctx.quadraticCurveTo(x+w,y,x+w,y+r);
    ctx.lineTo(x+w,y+h);
    ctx.lineTo(x,y+h);
    ctx.lineTo(x,y+r);
    ctx.quadraticCurveTo(x,y,x+r,y);
  }

  if(dir==="DOWN"){
    ctx.moveTo(x,y);
    ctx.lineTo(x+w,y);
    ctx.lineTo(x+w,y+h-r);
    ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);
    ctx.lineTo(x+r,y+h);
    ctx.quadraticCurveTo(x,y+h,x,y+h-r);
    ctx.lineTo(x,y);
  }

  if(dir==="LEFT"){
    ctx.moveTo(x+r,y);
    ctx.quadraticCurveTo(x,y,x,y+r);
    ctx.lineTo(x,y+h-r);
    ctx.quadraticCurveTo(x,y+h,x+r,y+h);
    ctx.lineTo(x+w,y+h);
    ctx.lineTo(x+w,y);
  }

  if(dir==="RIGHT"){
    ctx.moveTo(x,y);
    ctx.lineTo(x+w-r,y);
    ctx.quadraticCurveTo(x+w,y,x+w,y+r);
    ctx.lineTo(x+w,y+h-r);
    ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);
    ctx.lineTo(x,y+h);
    ctx.lineTo(x,y);
  }

  ctx.closePath();
  ctx.fill();
}

function updateScoreUI(){
  document.getElementById("score").textContent =
    `Score: ${score} | Best: ${bestScore}`;
}

function resetGame(){
  snake=[{
    gx:8, gy:8,
    x:8*box, y:8*box,
    tx:8*box, ty:8*box
  }];
  dir=null;
  score=0;
  gameOver=false;
  paused=false;
  document.getElementById("overlay").style.display="none";
  updateScoreUI();
}

resetGame();

document.getElementById("speed").oninput=e=>{
  speedDelay = +e.target.value;
};

document.getElementById("pause").onclick=()=>{
  paused=!paused;
  pause.textContent = paused ? "Resume" : "Pause";
};

document.addEventListener("keydown",e=>{
  if(gameOver || paused) return;

  const map={
    ArrowUp:"UP",ArrowDown:"DOWN",
    ArrowLeft:"LEFT",ArrowRight:"RIGHT",
    w:"UP",s:"DOWN",a:"LEFT",d:"RIGHT"
  };
  const next = map[e.key];
  if(!next) return;

  if(snake.length>1){
    if(
      (dir==="UP"&&next==="DOWN")||
      (dir==="DOWN"&&next==="UP")||
      (dir==="LEFT"&&next==="RIGHT")||
      (dir==="RIGHT"&&next==="LEFT")
    ) return;
  }
  dir=next;
});

function spawnFood(){
  food={x:Math.floor(Math.random()*grid),y:Math.floor(Math.random()*grid)};
}
spawnFood();

function update(){
  if(!dir) return;

  const h=snake[0];
  let nx=h.gx, ny=h.gy;

  if(dir==="UP")ny--;
  if(dir==="DOWN")ny++;
  if(dir==="LEFT")nx--;
  if(dir==="RIGHT")nx++;

  if(nx<0||ny<0||nx>=grid||ny>=grid){endGame();return;}

  for(let i=1;i<snake.length;i++){
    if(snake[i].gx===nx && snake[i].gy===ny){endGame();return;}
  }

  snake.unshift({
    gx:nx, gy:ny,
    x:h.x, y:h.y,
    tx:nx*box, ty:ny*box
  });

  if(nx===food.x && ny===food.y){
    score++;
    if(score>bestScore){
      bestScore=score;
      localStorage.setItem("htcja_best",bestScore);
    }
    updateScoreUI();
    spawnFood();
  } else snake.pop();
}

function draw(){
  ctx.clearRect(0,0,400,400);

  for(let y=0;y<grid;y++){
    for(let x=0;x<grid;x++){
      ctx.fillStyle=(x+y)%2?"#0f3":"#084";
      ctx.fillRect(x*box,y*box,box,box);
    }
  }

  ctx.fillStyle="red";
  ctx.beginPath();
  ctx.arc(food.x*box+10,food.y*box+10,7,0,Math.PI*2);
  ctx.fill();

  snake.forEach((s,i)=>{
    s.x+=(s.tx-s.x)*0.35;
    s.y+=(s.ty-s.y)*0.35;
    ctx.fillStyle=i===0?"var(--snake)":"var(--tail)";
    if(i===0) drawCapRect(s.x,s.y,box,box,6,dir||"UP");
    else ctx.fillRect(s.x,s.y,box,box);
  });
}

function endGame(){
  gameOver=true;
  document.getElementById("finalScore").textContent =
    `Score: ${score} | Best: ${bestScore}`;
  document.getElementById("overlay").style.display="flex";
}

function loop(t){
  if(!paused&&!gameOver&&t-lastMove>speedDelay){
    update(); lastMove=t;
  }
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>

</body>
</html>
